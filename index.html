<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlobalRemote Careers - Job Board</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load React, ReactDOM, and Babel for client-side JSX compilation -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Load Firebase libraries -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Expose Firebase modules globally for the Babel script to use
        window.firebase = { 
            initializeApp, 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            getFirestore, 
            collection, 
            addDoc, 
            query, 
            onSnapshot, 
            serverTimestamp 
        };
    </script>
    <style>
        /* Set font and ensure smooth scrolling */
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- The Root element where the React app will be rendered -->
    <div id="root"></div>

    <!-- The main script block containing the React component (using type="text/babel") -->
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // --- Global Variables and Firebase Setup (Accessing variables defined in the environment) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        const JOB_ROLES = [
            { title: 'Remote Software Engineer (L3)', department: 'Engineering', location: 'USA, UK, Canada', desc: 'Develop, test, and deploy high-quality software solutions using React and Node.js. Requires 3+ years experience.' },
            { title: 'Digital Marketing Specialist', department: 'Marketing', location: 'USA, UK, Canada', desc: 'Manage global digital campaigns, SEO, and social media strategy. Excellent English written communication is a must.' },
            { title: 'Customer Success Manager', department: 'Operations', location: 'USA, UK, Canada', desc: 'Serve as the main point of contact for enterprise clients, ensuring high retention rates. Strong client communication skills needed.' },
        ];
        
        const App = () => {
            const [db, setDb] = useState(null);
            const [auth, setAuth] = useState(null);
            const [userId, setUserId] = useState(null);
            const [isAuthReady, setIsAuthReady] = useState(false);
            const [applications, setApplications] = useState([]);
            const [activeJob, setActiveJob] = useState(null);
            const [submissionStatus, setSubmissionStatus] = useState(null);
        
            // Form state
            const [formData, setFormData] = useState({
                fullName: '',
                email: '',
                phone: '',
                address: '',
                country: '',
                resumeLink: '',
            });
        
            // 1. Firebase Initialization and Authentication
            useEffect(() => {
                if (!firebaseConfig || Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase configuration is missing.");
                    return;
                }
        
                try {
                    const app = firebase.initializeApp(firebaseConfig);
                    const firestoreDb = firebase.getFirestore(app);
                    const firebaseAuth = firebase.getAuth(app);
                    setDb(firestoreDb);
                    setAuth(firebaseAuth);
        
                    const authenticate = async () => {
                        if (initialAuthToken) {
                            await firebase.signInWithCustomToken(firebaseAuth, initialAuthToken);
                        } else {
                            await firebase.signInAnonymously(firebaseAuth);
                        }
                        setUserId(firebaseAuth.currentUser?.uid || 'anonymous');
                        setIsAuthReady(true);
                    };
                    authenticate();
                } catch (error) {
                    console.error("Firebase initialization failed:", error);
                }
            }, []);
        
            // 2. Real-time Listener for Applications (Admin View)
            useEffect(() => {
                if (!isAuthReady || !db) return;
        
                // Path: /artifacts/{appId}/public/data/job_applications
                const collectionPath = `artifacts/${appId}/public/data/job_applications`;
                const q = firebase.query(firebase.collection(db, collectionPath));
        
                const unsubscribe = firebase.onSnapshot(q, (snapshot) => {
                    const fetchedApplications = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data(),
                        // Convert Firestore Timestamp to readable date
                        timestamp: doc.data().timestamp ? new Date(doc.data().timestamp.seconds * 1000).toLocaleString() : 'N/A'
                    }));
                    setApplications(fetchedApplications.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)));
                }, (error) => {
                    console.error("Error fetching applications: ", error);
                });
        
                return () => unsubscribe();
            }, [isAuthReady, db]);
        
            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };
        
            const handleApplyClick = (job) => {
                setActiveJob(job);
                setSubmissionStatus(null);
                setFormData({
                    fullName: '',
                    email: '',
                    phone: '',
                    address: '',
                    country: '',
                    resumeLink: '',
                });
            };
        
            const handleSubmitApplication = async (e) => {
                e.preventDefault();
                if (!db || !userId) {
                    setSubmissionStatus({ type: 'error', message: 'Database not ready. Please wait a moment.' });
                    return;
                }
                
                // Simple client-side validation for required country
                if (!['USA', 'UK', 'Canada'].includes(formData.country)) {
                    setSubmissionStatus({ type: 'error', message: 'Application failed: Must be a resident of USA, UK, or Canada.' });
                    return;
                }
        
                try {
                    const applicationData = {
                        ...formData,
                        jobTitle: activeJob.title,
                        jobDepartment: activeJob.department,
                        applicantId: userId,
                        timestamp: firebase.serverTimestamp(),
                    };
        
                    const collectionPath = `artifacts/${appId}/public/data/job_applications`;
                    await firebase.addDoc(firebase.collection(db, collectionPath), applicationData);
        
                    setSubmissionStatus({ type: 'success', message: `Application for ${activeJob.title} submitted successfully!` });
                    setActiveJob(null); // Close form
                    setFormData({ fullName: '', email: '', phone: '', address: '', country: '', resumeLink: '' });
        
                } catch (error) {
                    console.error("Error submitting application:", error);
                    setSubmissionStatus({ type: 'error', message: 'Submission failed. Check console for details.' });
                }
            };
        
            const StatusMessage = () => {
                if (!submissionStatus) return null;
                const baseClasses = "p-3 mt-4 rounded-lg font-medium";
                const classes = submissionStatus.type === 'success'
                    ? `${baseClasses} bg-green-100 text-green-700`
                    : `${baseClasses} bg-red-100 text-red-700`;
        
                return <div className={classes}>{submissionStatus.message}</div>;
            };
        
        
            const JobApplicationForm = () => (
                <div className="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 overflow-y-auto">
                    <div className="bg-white p-6 md:p-10 rounded-xl shadow-2xl max-w-lg w-full transform transition-all duration-300">
                        <h2 className="text-2xl font-extrabold text-indigo-700 mb-2">{activeJob.title}</h2>
                        <p className="text-sm text-gray-500 mb-6">Department: {activeJob.department} | Remote in {activeJob.location}</p>
        
                        <form onSubmit={handleSubmitApplication} className="space-y-4">
                            
                            {/* Input: Full Name */}
                            <input
                                type="text"
                                name="fullName"
                                value={formData.fullName}
                                onChange={handleInputChange}
                                placeholder="Full Name"
                                required
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"
                            />
        
                            {/* Input: Email */}
                            <input
                                type="email"
                                name="email"
                                value={formData.email}
                                onChange={handleInputChange}
                                placeholder="Email Address"
                                required
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"
                            />
        
                            {/* Input: Phone */}
                            <input
                                type="tel"
                                name="phone"
                                value={formData.phone}
                                onChange={handleInputChange}
                                placeholder="Phone Number"
                                required
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"
                            />
                            
                            {/* Input: Address */}
                            <textarea
                                name="address"
                                value={formData.address}
                                onChange={handleInputChange}
                                placeholder="Full Mailing Address"
                                required
                                rows="2"
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 resize-none"
                            />
        
                            {/* Input: Country */}
                            <select
                                name="country"
                                value={formData.country}
                                onChange={handleInputChange}
                                required
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 bg-white"
                            >
                                <option value="">Select Residency (USA, UK, or Canada)</option>
                                <option value="USA">USA</option>
                                <option value="UK">UK</option>
                                <option value="Canada">Canada</option>
                                <option value="Other">Other (Not Eligible)</option>
                            </select>
        
                            {/* Input: Resume Link */}
                            <input
                                type="url"
                                name="resumeLink"
                                value={formData.resumeLink}
                                onChange={handleInputChange}
                                placeholder="Link to Resume (e.g., Google Drive, Dropbox URL)"
                                required
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"
                            />
                            <p className="text-xs text-gray-500 pt-1">
                                *Note: Please provide a public link to your resume document (e.g., a shared Google Drive PDF).
                            </p>
        
                            {/* Submission Button */}
                            <div className="flex justify-between items-center pt-4">
                                <button
                                    type="button"
                                    onClick={() => setActiveJob(null)}
                                    className="px-6 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition duration-150"
                                >
                                    Cancel
                                </button>
                                <button
                                    type="submit"
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-150 shadow-md"
                                >
                                    Submit Application
                                </button>
                            </div>
                            <StatusMessage />
                        </form>
                    </div>
                </div>
            );
        
        
            const JobCard = ({ job }) => (
                <div className="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition duration-300 border border-gray-100">
                    <h3 className="text-xl font-bold text-gray-800 mb-1">{job.title}</h3>
                    <p className="text-sm text-indigo-600 font-medium mb-3">{job.department} | Remote</p>
                    <p className="text-gray-600 mb-4 text-sm">{job.desc}</p>
                    <p className="text-xs text-gray-500 mb-4">Eligible Locations: {job.location}</p>
                    <button
                        onClick={() => handleApplyClick(job)}
                        className="w-full py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-150 transform hover:scale-[1.01] shadow-md"
                    >
                        Apply Now
                    </button>
                </div>
            );
        
            const ApplicationDashboard = () => {
                const currentUserIsAdmin = auth?.currentUser?.uid === userId; // Simple check for demonstration
                
                return (
                    <div className="mt-12 p-6 bg-gray-50 rounded-xl shadow-inner border-t-4 border-indigo-400">
                        <h2 className="text-2xl font-extrabold text-gray-800 mb-4">Application Dashboard (Admin View)</h2>
                        <p className="text-sm text-gray-600 mb-6">Total Applications: **{applications.length}** | User ID: **{userId || 'Loading...'}**</p>
                        
                        {applications.length === 0 ? (
                            <p className="text-gray-500 italic">No applications submitted yet. Try submitting one!</p>
                        ) : (
                            <div className="space-y-4">
                                {applications.map((app) => (
                                    <div key={app.id} className="bg-white p-4 rounded-lg shadow border border-gray-200">
                                        <div className="flex justify-between items-start mb-2">
                                            <h4 className="text-lg font-semibold text-indigo-700">{app.jobTitle}</h4>
                                            <span className="text-xs text-gray-500">{app.timestamp}</span>
                                        </div>
                                        <p className="text-sm text-gray-700">
                                            <strong className="font-medium">Applicant:</strong> {app.fullName} ({app.email})
                                        </p>
                                        <p className="text-xs text-gray-500">
                                            {app.address} | {app.country} | Phone: {app.phone}
                                        </p>
                                        <a 
                                            href={app.resumeLink} 
                                            target="_blank" 
                                            rel="noopener noreferrer" 
                                            className="text-sm text-blue-500 hover:text-blue-700 underline mt-1 block truncate"
                                        >
                                            Resume Link
                                        </a>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                );
            };
        
            return (
                <div className="min-h-screen bg-gray-100 font-sans p-4 md:p-8">
                    <header className="text-center py-10 bg-white rounded-xl shadow-md mb-8">
                        <h1 className="text-4xl font-extrabold text-gray-900 tracking-tight">
                            <span className="text-indigo-600">GlobalRemote</span> Careers
                        </h1>
                        <p className="mt-2 text-xl text-gray-500">
                            Your next great career move, 100% remote.
                        </p>
                    </header>
        
                    <main className="max-w-6xl mx-auto">
                        {/* Job Listings Section */}
                        <section className="mb-12">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-200 pb-2">Open Positions</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {JOB_ROLES.map((job, index) => (
                                    <JobCard key={index} job={job} />
                                ))}
                            </div>
                        </section>
        
                        {/* Application Dashboard Section */}
                        <section>
                            <ApplicationDashboard />
                        </section>
                    </main>
        
                    {/* Modal for Application Form */}
                    {activeJob && <JobApplicationForm />}
                </div>
            );
        };
        
        // Render the App component
        ReactDOM.render(<App />, document.getElementById('root'));

    </script>
</body>
</html>